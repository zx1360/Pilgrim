import{r,q as o,C as _,y as e,D as k,A as y,O as x,G as p,H as h,v as i,K as U,L as c,N as B}from"./@vue-CrxPK7X6.js";import{a as V}from"./axios-xsH4HHeE.js";import{_ as I,u as T}from"./index-C9jkMtV2.js";import"./vue-router-DQhqLy48.js";import"./pinia-BiUrJzFP.js";const q={id:"shelter"},z={class:"write_box"},R={class:"bottom"},G=["src"],H={class:"pic_btn"},K={class:"label_box"},M=["onClick"],O={class:"label_append"},W={class:"title_box"},j={class:"archive_box"},J=["onClick"],P={class:"archives"},Q={class:"content"},X={class:"content_upper"},Y={class:"date"},Z={class:"text"},ee={class:"appendix"},te={class:"labels"},se={class:"label"},ae=["onClick"],le={__name:"archiveView",setup(oe){const D=T(),C=r([]),d=r([]);V.get("/api/archive/archives/all").then(s=>{console.log(s.data),C.value=s.data,d.value=s.data.map(()=>!0)}).catch(s=>console.error(s));const g=r(""),v=r([]);function S(){const s=new FormData;u.value.forEach(t=>{s.append("files",t.file)}),s.append("content",g.value),v.value.forEach(t=>{s.append("labels",t)}),V.post("/api/archive/archives/write",s,{headers:{"Content-Type":"multipart/form-data"},paramsSerializer:t=>qs.stringify(t,{arrayFormat:"repeat"})}).then(t=>{console.log(t.data),location.reload(!0)}).catch(t=>console.error(t))}const u=r([]),m=r(null);function F(s){if(!s.target.files||s.target.files.length===0)return;const t=Array.from(s.target.files);u.value=[],t.forEach(a=>{u.value=[];const l=new FileReader;l.onload=n=>{u.value.push({file:a,preview:n.target.result})},l.readAsDataURL(a)}),m.value.value=""}const f=r("");function $(){let s;s=f.value,f.value="",s.trim().length!=0&&(v.value.includes(s.trim())||v.value.push(s))}function A(s){v.value.splice(s,1)}const b=r(!1);function E(s){d.value.splice(s,1,!d.value[s])}function L(s){console.log(s),D.call_mask_method("show_imgs",s)}return(s,t)=>(i(),o("div",q,[_(e("div",z,[e("div",{onClick:t[0]||(t[0]=a=>b.value=!1),class:"close iconfont"},""),e("div",{class:y([{inactive:v.value.length==0},"submit iconfont"]),onClick:S},"",2),_(e("textarea",{"onUpdate:modelValue":t[1]||(t[1]=a=>g.value=a),class:"content"},null,512),[[x,g.value]]),e("div",R,[e("div",{class:y([{hasImage:u.value.length},"pic_relates"])},[(i(!0),o(p,null,h(u.value,(a,l)=>(i(),o("div",{key:l,class:"pic"},[e("img",{src:a.preview,alt:""},null,8,G)]))),128)),e("div",H,[e("label",{onClick:t[2]||(t[2]=(...a)=>m.value.click&&m.value.click(...a)),class:"iconfont"},""),e("input",{onChange:F,ref_key:"imgInput",ref:m,type:"file",accept:"image/*",multiple:""},null,544)])],2),t[5]||(t[5]=e("div",{class:"vertical_line"},null,-1)),e("div",K,[(i(!0),o(p,null,h(v.value,(a,l)=>(i(),o("div",{key:l,class:"label_appended"},[U(c(a)+" ",1),e("span",{onClick:n=>A(l),class:"iconfont"},"",8,M)]))),128)),e("div",O,[_(e("input",{"onUpdate:modelValue":t[3]||(t[3]=a=>f.value=a),type:"text"},null,512),[[x,f.value]]),e("span",{onClick:$,class:"iconfont"},"")])])])],512),[[k,b.value]]),e("div",W,[e("span",{onClick:t[4]||(t[4]=a=>b.value=!0),class:"title"},"Archives")]),t[8]||(t[8]=e("div",{class:"tag_box"},[e("div",{class:"tags"})],-1)),e("div",j,[(i(!0),o(p,null,h(C.value,(a,l)=>(i(),o("div",{key:l,class:"year_box"},[e("div",{onClick:n=>E(l),class:"year"},c(a.year),9,J),_(e("div",{class:"overview"},c(a.archives.length)+" 条记录.",513),[[k,!d.value[l]]]),_(e("div",P,[(i(!0),o(p,null,h(a.archives,(n,N)=>(i(),o("div",{key:N,class:"archive"},[t[7]||(t[7]=e("div",{class:"time_axis"},null,-1)),e("div",Q,[e("div",X,[e("div",Y,c(n.date),1),e("div",Z,c(n.content),1)]),e("div",ee,[e("div",te,[t[6]||(t[6]=e("div",{class:"label_icon iconfont"},"",-1)),(i(!0),o(p,null,h(n.labels,w=>(i(),o("div",se,c(w),1))),256))]),n.imgs.length?(i(),o("div",{key:0,onClick:w=>L(n.imgs),class:"archive_showImage iconfont"}," +"+c(n.imgs.length),9,ae)):B("",!0)])])]))),128))],512),[[k,d.value[l]]])]))),128))])]))}},ue=I(le,[["__scopeId","data-v-94e55a44"]]);export{ue as default};
