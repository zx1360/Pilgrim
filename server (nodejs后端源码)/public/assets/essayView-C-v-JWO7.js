import{f as F,q as i,v as l,y as s,L as p,G as y,H as f,N as x,u as S,r as h,z as ae,C as j,F as le,D as G,A as C,O as K,K as P,P as A}from"./@vue-CrxPK7X6.js";import{a as L}from"./axios-xsH4HHeE.js";import{q as B}from"./qs-Cycbn6eS.js";import{_ as z,u as ne}from"./index-C9jkMtV2.js";import{M as ie}from"./markdown-it-C44Roubk.js";import"./call-bind-apply-helpers-BZzljMEd.js";import"./function-bind-CHqF18-c.js";import"./es-errors-CxTyLFAO.js";import"./side-channel-BNp9wz8W.js";import"./object-inspect-VZb6qSZx.js";import"./side-channel-list-DaH2uSl3.js";import"./side-channel-map-DBZ9ueMx.js";import"./get-intrinsic-BxF11L2u.js";import"./es-object-atoms-BR76m4z7.js";import"./math-intrinsics-DP1tGiab.js";import"./gopd-C1lCZ5Qs.js";import"./es-define-property-D_7cP-M3.js";import"./has-symbols-BaUvM3gb.js";import"./get-proto-D9NZsjdc.js";import"./dunder-proto-DLmApA0o.js";import"./hasown-DwiY0sux.js";import"./call-bound-Dl_jZ2IL.js";import"./side-channel-weakmap-DGV9TSlS.js";import"./vue-router-DQhqLy48.js";import"./pinia-BiUrJzFP.js";import"./mdurl-k9Sl0PQj.js";import"./uc.micro-kMc2yuuw.js";import"./entities-C20TfXL6.js";import"./linkify-it-DmNjr4Kv.js";import"./punycode.js-Dj65hjkv.js";const V=a=>{if(!a)return{texts:[],images:[]};const _=a.split(/\r?\n/),c=[],o=[];return _.forEach(v=>{const m=v.trim();m.startsWith("![")||m.startsWith("!|")?o.push(m):c.push(v)}),{texts:c,images:o}},M=a=>{if(a.startsWith("![")){const _=/!\[(.*?)\]\((.*?)\)/,c=a.match(_);return c?c[2]:""}else if(a.startsWith("!|")){const _=/!\|(.*?)\|<(.*?)>/,c=a.match(_);return c?c[2]:""}return""},O=a=>{if(a.startsWith("![")){const _=/!\[(.*?)\]\((.*?)\)/,c=a.match(_);return c?c[1]:"文章图片"}else if(a.startsWith("!|")){const _=/!\|(.*?)\|<(.*?)>/,c=a.match(_);return c?c[1]:"文章图片"}return"文章图片"},oe={class:"date"},ce={class:"content"},re={class:"appendix"},ue={class:"labels"},de={class:"label"},ve={key:0,class:"pics"},me=["onClick"],_e=["src","alt"],he={key:0,class:"pics_leftout"},pe=["src"],ge={__name:"essay_message",props:{essay:Object},emits:["watch_imgs"],setup(a,{emit:_}){const c=_,o=F(()=>m=>V(m.content)),v=F(()=>m=>V(m.content).images.map(r=>M(r)));return(m,r)=>(l(),i(y,null,[s("div",oe,p(a.essay.date),1),s("div",ce,[(l(!0),i(y,null,f(o.value(a.essay).texts,(u,d)=>(l(),i("div",{key:d,class:"paragraph"},p(u),1))),128))]),s("div",re,[s("div",ue,[r[1]||(r[1]=s("div",{class:"label_icon iconfont"},"",-1)),(l(!0),i(y,null,f(a.essay.labels,(u,d)=>(l(),i("div",de,p(u),1))),256))]),o.value(a.essay).images.length>0?(l(),i("div",ve,[(l(!0),i(y,null,f(o.value(a.essay).images.slice(0,2),(u,d)=>(l(),i("div",{onClick:D=>c("watch_imgs",v.value(a.essay),d),key:d,class:"pic"},[s("img",{src:S(M)(u),alt:S(O)(u)},null,8,_e)],8,me))),128)),o.value(a.essay).images.length>2?(l(),i("div",he,[s("div",{onClick:r[0]||(r[0]=u=>c("watch_imgs",v.value(a.essay),2)),class:"bluring"},"+"+p(o.value(a.essay).images.length-2),1),s("img",{src:S(M)(o.value(a.essay).images[2]),alt:""},null,8,pe)])):x("",!0)])):x("",!0)])],64))}},ye=z(ge,[["__scopeId","data-v-5134e696"]]),fe={class:"date"},be={class:"content"},ke=["innerHTML"],$e={class:"appendix"},we={class:"labels"},Ce={class:"label"},xe={__name:"essay_md",props:{essay:Object},setup(a){const _=a,c=h(""),o=h(null),v=h(null);ae(()=>{v.value=new ie,m()});const m=()=>{v.value&&(c.value=v.value.render(_.essay.content))};return(r,u)=>(l(),i(y,null,[s("div",fe,p(a.essay.date),1),s("div",be,[s("div",{ref_key:"essay_div",ref:o,innerHTML:c.value,class:"md_essay"},null,8,ke)]),s("div",$e,[s("div",we,[u[0]||(u[0]=s("div",{class:"label_icon iconfont"},"",-1)),(l(!0),i(y,null,f(a.essay.labels,d=>(l(),i("div",Ce,p(d),1))),256))])])],64))}},Se=z(xe,[["__scopeId","data-v-d4b7dd5c"]]),De={key:0,class:"pics"},Me=["onClick"],Fe=["src","alt"],Ie=["src","alt"],Ee={class:"date"},We={class:"content"},Le={class:"appendix"},Ve={class:"labels"},ze={class:"label"},He={__name:"essay_html",props:{essay:Object},emits:["watch_imgs"],setup(a,{emit:_}){const c=_,o=F(()=>m=>V(m.content)),v=F(()=>m=>V(m.content).images.map(r=>M(r)));return(m,r)=>(l(),i(y,null,[o.value(a.essay).images.length>=2?(l(),i("div",De,[(l(!0),i(y,null,f(o.value(a.essay).images,(u,d)=>(l(),i("div",{onClick:D=>c("watch_imgs",v.value(a.essay),d),key:d,class:"pic"},[s("img",{src:S(M)(u),alt:S(O)(u)},null,8,Fe)],8,Me))),128))])):o.value(a.essay).images.length===1?(l(),i("div",{key:1,onClick:r[0]||(r[0]=u=>c("watch_imgs",v.value(a.essay))),class:"single_pic"},[s("img",{src:S(M)(o.value(a.essay).images[0]),alt:S(O)(o.value(a.essay).images[0])},null,8,Ie)])):x("",!0),s("div",Ee,p(a.essay.date),1),s("div",We,[(l(!0),i(y,null,f(o.value(a.essay).texts,(u,d)=>(l(),i("div",{key:d,class:"paragraph"},p(u),1))),128))]),s("div",Le,[s("div",Ve,[r[1]||(r[1]=s("div",{class:"label_icon iconfont"},"",-1)),(l(!0),i(y,null,f(a.essay.labels,(u,d)=>(l(),i("div",ze,p(u),1))),256))])])],64))}},Te=z(He,[["__scopeId","data-v-ee872948"]]),je={id:"shelter"},Ae={class:"diary_frame"},Be={class:"diary_box"},Oe={key:0,class:"cur_writing"},Ue={class:"writing_upper"},Ne={class:"cur_date"},qe={class:"public_setting"},Re={class:"format_box"},Ye=["innerHTML"],Ge={class:"writing_appendix"},Ke={class:"pic_relates"},Pe=["src"],Je={class:"pic_btn"},Qe={class:"label_box"},Xe=["onClick"],Ze={class:"highly_used_labels"},es=["onClick"],ss={class:"label_append"},ts={class:"year_box"},as=["onClick"],ls={class:"day_box"},ns={class:"tag_shelter"},is={class:"tags"},os=["onClick"],cs={class:"tag_count"},rs={class:"btn_box iconfont"},us=["max"],ds={__name:"essayView",setup(a){const _=ne(),c=F(()=>{const t=new Date,e=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),g=String(t.getDate()).padStart(2,"0");return`${e}-${n}-${g}`}),o=h([]);L.get("/api/essay/tags").then(t=>{console.log(t.data),o.value=t.data.map(e=>({...e,chosen:!0}))}).catch(t=>{console.error(t)});const v=h([]);L.get("/api/essay/essays/all/myself").then(t=>{v.value=t.data,r.value=v.value.map(()=>!1)}).catch(t=>{console.error(t)});function m(t){L.get("/api/essay/essays/some/myself",{params:{tags:t.map(e=>e.name)},paramsSerializer:e=>B.stringify(e,{arrayFormat:"repeat"})}).then(e=>{if(e.data.length==0)return v.value=[];v.value=e.data,r.value=v.value.map(()=>!1)}).catch(e=>{console.error(e)})}const r=h([]),u=t=>{r.value=r.value.map((e,n)=>n===t?!e:e)},d=h(1),D=h(0),U=h(null);function H(t){D.value=t,U.value.style.left=8.8*t+"rem"}function J(){o.value.forEach(t=>{t.chosen=!1})}function Q(t){o.value[t].chosen=!o.value[t].chosen,m(o.value.filter(e=>e.chosen))}const k=h(0),I=h(c.value);function X(){++k.value>=2}const Z=F(()=>w.value.length>0),$=h([]),N=h(null);function ee(t){if(!t.target.files||t.target.files.length===0)return;const e=Array.from(t.target.files);$.value=[],e.forEach(n=>{$.value=[];const g=new FileReader;g.onload=b=>{$.value.push({file:n,preview:b.target.result})},g.readAsDataURL(n)}),console.log($),N.value.value=""}const w=h([]),E=h("");function q(t){let e;if(t)e=t;else if(E.value)e=E.value,E.value="";else return;e.trim().length!=0&&(w.value.includes(e.trim())||w.value.push(e),R())}function se(t){w.value.splice(t,1),R()}function R(){L.get("/api/essay/essays/day",{params:{date:I.value,labels:w.value},paramsSerializer:t=>B.stringify(t,{arrayFormat:"repeat"})}).then(t=>{const e=t.data.data;Object.keys(e).length!==0&&(T.value="",e.content.split(/\r?\n/).forEach(n=>{/^!\|.*?\|.*?>$/.test(n)||(T.value+=`<div>${n}</div>`)}),console.log("有可覆盖的随笔"))}).catch(t=>{console.error(t)})}const W=h(null),T=h("");function te(){const t=new FormData;t.append("create_time",I.value),t.append("format",D.value),D.value==1?(t.append("content",W.value.innerText),console.log(W.value.innerText)):t.append("content",W.value.innerText.trim().split(/\r?\n/).filter(e=>e.trim().length>0).join(`
`)),t.append("word_count",W.value.innerText.trim().length),t.append("is_public",d.value),w.value.forEach(e=>{t.append("labels",e)}),$.value.forEach(e=>{t.append("images",e.file)}),L.post("/api/essay/new",t,{headers:{"Content-Type":"multipart/form-data"},paramsSerializer:e=>B.stringify(e,{arrayFormat:"repeat"})}).then(e=>{console.log("随笔提交成功."),location.reload(!0)}).catch(e=>{console.error(e)})}function Y(t,e){_.call_mask_method("show_imgs",t,e)}return(t,e)=>(l(),i("div",je,[s("div",Ae,[s("div",Be,[k.value>=2?(l(),i("div",Oe,[s("div",Ue,[s("div",Ne,p(I.value),1),s("div",qe,[s("div",{style:le({left:d.value?"50%":"0px"}),class:"highlight_choice"},null,4),s("div",{onClick:e[0]||(e[0]=n=>d.value=1-d.value),class:"public_btn"},"私密"),s("div",{onClick:e[1]||(e[1]=n=>d.value=1-d.value),class:"public_btn"},"公开")]),s("div",Re,[s("div",{ref_key:"highlight_choice",ref:U,class:"highlight_choice"},null,512),s("div",{onClick:e[2]||(e[2]=n=>H(0)),class:"format_choice"},"说说"),s("div",{onClick:e[3]||(e[3]=n=>H(1)),class:"format_choice"},"md笔记"),s("div",{onClick:e[4]||(e[4]=n=>H(2)),class:"format_choice"},"类html")])]),s("div",{innerHTML:T.value,ref_key:"essayDiv",ref:W,class:"input_text",contenteditable:"true"},null,8,Ye),s("div",Ge,[j(s("div",Ke,[s("div",{class:C([{hasImage:$.value.length},"pic_box"])},[(l(!0),i(y,null,f($.value,(n,g)=>(l(),i("div",{key:g,class:"img"},[s("img",{src:n.preview,alt:""},null,8,Pe)]))),128))],2),s("div",Je,[e[9]||(e[9]=s("label",{class:"iconfont"},"",-1)),s("input",{onChange:ee,ref_key:"imgInput",ref:N,type:"file",accept:"image/*",multiple:""},null,544)])],512),[[G,D.value!=1]]),e[10]||(e[10]=s("div",{class:"vertical_line"},null,-1)),s("div",Qe,[(l(!0),i(y,null,f(w.value,(n,g)=>(l(),i("div",{key:g,class:"label_appended"},[P(p(n)+" ",1),s("span",{onClick:b=>se(g),class:"iconfont"},"",8,Xe)]))),128)),s("div",Ze,[(l(!0),i(y,null,f(o.value.slice(0,4),(n,g)=>(l(),i("div",{onClick:b=>q(n.name),class:"label_for_choose"},p(n.name),9,es))),256))]),s("div",ss,[j(s("input",{"onUpdate:modelValue":e[5]||(e[5]=n=>E.value=n),type:"text"},null,512),[[K,E.value]]),s("span",{onClick:e[6]||(e[6]=n=>q()),class:"iconfont"},"")])])])])):x("",!0),(l(!0),i(y,null,f(v.value,(n,g)=>(l(),i("div",ts,[s("div",{onClick:b=>u(g),class:"year_btn"},null,8,as),s("div",{class:C([{none:!r.value[g]},"overview"])},p(n.year)+"年: "+p(n.essay_count)+"份记录, "+p(n.total_word_count)+"字.",3),s("div",{class:C([{none:r.value[g]},"essays"])},[(l(!0),i(y,null,f(n.essays,b=>(l(),i("div",ls,[b.format==0?(l(),A(ye,{key:0,onWatch_imgs:Y,essay:b},null,8,["essay"])):x("",!0),b.format==1?(l(),A(Se,{key:1,essay:b},null,8,["essay"])):x("",!0),b.format==2?(l(),A(Te,{key:2,onWatch_imgs:Y,essay:b},null,8,["essay"])):x("",!0)]))),256))],2)]))),256))]),s("div",ns,[s("div",{onClick:J,class:"clear_tags iconfont"},""),s("div",is,[(l(!0),i(y,null,f(o.value,(n,g)=>(l(),i("div",{onClick:b=>Q(g),class:C([{chosen:n.chosen},"tag_box"])},[P(p(n.name)+" ",1),s("span",cs,p(n.count),1)],10,os))),256))])]),s("div",rs,[s("div",{class:C([{disabled:k.value>=2},"btn"]),onClick:X},"",2),s("div",{class:C([{disabled:k.value<2},"btn"]),onClick:e[7]||(e[7]=n=>k.value=0)},"",2),s("div",{class:C([{disabled:k.value<2||!Z.value},"btn"]),onClick:te},"",2)]),j(s("input",{"onUpdate:modelValue":e[8]||(e[8]=n=>I.value=n),id:"diary_date",type:"date",min:"2000-01-01",max:c.value},null,8,us),[[K,I.value],[G,k.value==1]])])]))}},Us=z(ds,[["__scopeId","data-v-11628a46"]]);export{Us as default};
